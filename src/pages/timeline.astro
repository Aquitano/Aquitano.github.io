---
import Layout from '../layouts/Layout.astro';

type ExperienceEntry = {
    role: string;
    company: string;
    period: string;
    highlights: string[];
};

type SkillGroup = {
    title: string;
    items: string[];
};

const experiences: ExperienceEntry[] = [
    {
        role: 'Software Development Intern & Working Student',
        company: 'itestra GmbH · Passau',
        period: 'Mar 2025 – Jul 2025, Oct 2025 – Present',
        highlights: [
            'Migrated ~12K LOC COBOL-Vertragslogik in eine Java/Quarkus-Architektur und reduzierte den Codeumfang um 40%.',
            'Validierte mehrstufige Batch-Workflows (JBeret, Panache, Hibernate), um konsistente Outputs sicherzustellen.',
        ],
    },
    {
        role: 'Software Engineering Intern',
        company: 'CHECK24 Vergleichsportal GmbH · München',
        period: 'Aug 2025 – Sep 2025',
        highlights: [
            'Konzipierte eine asynchrone ActiveMQ-Pipeline zur Entkopplung kritischer Provider-Antworten.',
            'Halbierte die P95-Latenz auf ~150 ms bei 1.5 M Events/Tag und etablierte neue Grafana-Metriken.',
        ],
    },
    {
        role: 'Software Development Intern',
        company: '4process AG · Passau',
        period: 'Jul 2024 – Aug 2024',
        highlights: [
            'Baute ein internes Ideenportal mit SAP Fiori Elements zur Strukturierung von Vorschlägen.',
            'Implementierte ein Java-Tool für SAP Sales Cloud mit >5k validierten Excel-Updates/Sekunde.',
        ],
    },
];

const skillGroups: SkillGroup[] = [
    {
        title: 'Backend & Services',
        items: ['Java', 'Spring Boot', 'Quarkus', 'JPA/Hibernate', 'Node.js', 'Express.js', 'tRPC', 'Python', 'SQL'],
    },
    {
        title: 'Frontend & Product',
        items: ['TypeScript', 'React', 'Next.js', 'SolidJS', 'Astro', 'Tailwind CSS'],
    },
    {
        title: 'Platform & Observability',
        items: [
            'Docker & Kubernetes',
            'Terraform',
            'Linux/Bash',
            'GitHub Actions',
            'ActiveMQ',
            'Grafana & Prometheus',
            'PostgreSQL',
            'Elasticsearch',
        ],
    },
    {
        title: 'Self-Hosting & Ops',
        items: ['NixOS', 'Proxmox', 'Traefik', 'WireGuard', 'Ansible', 'GitLab', 'Nextcloud'],
    },
    {
        title: 'Languages',
        items: ['German (Native)', 'English (B2+/C1)', 'Latin'],
    },
];

const coreSkills = [
    {
        name: 'Java',
        accent: 'rgba(37, 99, 235, 0.65)',
    },
    {
        name: 'TypeScript',
        accent: 'rgba(14, 165, 233, 0.6)',
    },
];

const languageGroup = skillGroups.find((group) => group.title === 'Languages');
const primarySkillGroups = skillGroups.filter((group) => group.title !== 'Languages');
---

<Layout title="Timeline | Breindl Thomas" active="Über mich">
    <div class="scroll-container">
        <section class="timeline-section experience-bento">
            <div class="wrapper">
                <div class="section-heading">
                    <h2>Work Experience</h2>
                </div>
                <div class="experience-grid">
                    {
                        experiences.map((exp) => (
                            <article class="bento-card bento-card--experience experience-card">
                                <div class="experience-card__header">
                                    <span class="period">{exp.period}</span>
                                    <h3>{exp.role}</h3>
                                    <p class="company">{exp.company}</p>
                                </div>
                                <ul class="experience-points">
                                    {exp.highlights.map((highlight) => (
                                        <li>{highlight}</li>
                                    ))}
                                </ul>
                            </article>
                        ))
                    }
                </div>
            </div>
        </section>

        <section class="timeline-section skills-bento">
            <div class="wrapper px-4">
                <div class="section-heading">
                    <h2>Skills & Tools</h2>
                </div>
                <div class="skills-grid">
                    <article class="bento-card bento-card--skill core-skills-card">
                        <div class="card-heading">
                            <span>Core Languages</span>
                        </div>
                        <div class="core-language-stack">
                            {
                                coreSkills.map((skill, index) => (
                                    <div
                                        class="core-lang-card"
                                        tabindex="0"
                                        style={`--card-index: ${index}; --card-accent: ${skill.accent};`}
                                    >
                                        <p class="core-lang-card__label">{skill.name}</p>
                                    </div>
                                ))
                            }
                        </div>
                    </article>

                    {
                        primarySkillGroups.map((group) => (
                            <article class="bento-card bento-card--skill">
                                <div class="card-heading">
                                    <span>{group.title}</span>
                                </div>
                                <div class="skill-chip-grid">
                                    {group.items.map((item) => (
                                        <span class="skill-chip">{item}</span>
                                    ))}
                                </div>
                            </article>
                        ))
                    }

                    {
                        languageGroup && (
                            <article class="bento-card bento-card--skill">
                                <div class="card-heading">
                                    <span>{languageGroup.title}</span>
                                </div>
                                <div class="skill-chip-grid">
                                    {languageGroup.items.map((lang) => (
                                        <span class="skill-chip">{lang}</span>
                                    ))}
                                </div>
                            </article>
                        )
                    }
                </div>
            </div>
        </section>
    </div>
</Layout>

<style lang="scss">
    @use '@assets/css/animation.scss';

    .scroll-container {
        padding-top: 3rem;
        padding-bottom: clamp(2rem, 1rem + 3vw, 4rem);
    }

    .wrapper {
        width: 100%;
        max-width: 1200px;
        margin: 0 auto;
        padding-bottom: clamp(3rem, 2rem + 4vw, 6rem);
    }

    .experience-bento .wrapper {
        padding-top: clamp(4rem, 2.5rem + 4vw, 7rem);
    }

    .skills-bento .wrapper {
        padding-top: clamp(2rem, 1.5rem + 2vw, 3.5rem);
        padding-bottom: clamp(2.5rem, 1.5rem + 3vw, 4rem);
    }

    .section-heading {
        margin-bottom: clamp(1.5rem, 1rem + 1vw, 2.5rem);
        max-width: 760px;

        h1,
        h2 {
            font-family: 'Helvetica Now Display DW', sans-serif;
            font-weight: 900;
            line-height: 1.1;
            font-size: clamp(2rem, 1.2rem + 3vw, 3.2rem);
            color: #44403c;
        }
    }

    .timeline-section {
        color: rgba(15, 20, 30, 0.75);
    }

    .timeline-section .section-heading h2 {
        color: #44403c;
    }

    .experience-bento .section-heading h2 {
        font-size: clamp(2.4rem, 1.6rem + 3vw, 3.6rem);
    }

    .experience-grid,
    .skills-grid {
        display: grid;
        gap: 1.2rem;
        grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
        margin-top: clamp(1rem, 0.8rem + 1vw, 2rem);
    }

    .bento-card {
        position: relative;
        border-radius: clamp(1.2rem, 0.9rem + 1vw, 2rem);
        padding: clamp(1.5rem, 1.2rem + 1vw, 2.5rem);
        background: linear-gradient(165deg, rgba(10, 12, 23, 0.95), rgba(15, 23, 42, 0.82));
        border: 1px solid rgba(255, 255, 255, 0.08);
        box-shadow: 0 28px 50px rgba(2, 6, 23, 0.55);
        display: flex;
        flex-direction: column;
        gap: 1.3rem;
        backdrop-filter: blur(14px);
        color: rgba(243, 244, 246, 0.9);
        opacity: 0;
        transform: translate3d(0, 24px, 0);
        transition:
            opacity 0.8s ease,
            transform 0.8s ease;
        overflow: hidden;

        &.is-visible {
            opacity: 1;
            transform: translate3d(0, 0, 0);
        }
    }

    .bento-card > * {
        position: relative;
        z-index: 1;
    }

    .card-heading {
        display: flex;
        flex-direction: column;
        gap: 0.35rem;
    }

    .card-heading span {
        font-size: 0.74rem;
        letter-spacing: 0.32em;
        text-transform: uppercase;
        color: rgba(226, 232, 240, 0.7);
        font-weight: 600;
    }

    .bento-card--experience {
        border-color: rgba(148, 163, 184, 0.25);
        background: linear-gradient(170deg, rgba(10, 12, 23, 0.96), rgba(15, 23, 42, 0.8));
    }

    .experience-card {
        display: flex;
        flex-direction: column;
        gap: 1.2rem;
    }

    .experience-card__header {
        display: flex;
        flex-direction: column;
        gap: 0.35rem;
    }

    .experience-card__header .period {
        font-size: 0.75rem;
        letter-spacing: 0.35em;
        text-transform: uppercase;
        color: rgba(199, 210, 254, 0.9);
        font-weight: 600;
    }

    .experience-card__header h3 {
        margin: 0;
        font-family: 'Helvetica Now Display DW', sans-serif;
        font-size: 1.45rem;
        color: rgba(248, 250, 252, 0.95);
    }

    .experience-card__header .company {
        color: rgba(226, 232, 240, 0.7);
        margin: 0;
    }

    .experience-points {
        margin: 0;
        list-style: disc;
        list-style-position: outside;
        padding-left: 1.4rem;
        color: rgba(226, 232, 240, 0.78);
        line-height: 1.55;
    }

    .experience-points li::marker {
        color: rgba(129, 140, 248, 0.85);
    }

    .experience-points li + li {
        margin-top: 0.45rem;
    }

    .bento-card--skill {
        background: linear-gradient(165deg, rgba(6, 10, 25, 0.95), rgba(18, 34, 63, 0.85));
    }

    .skill-chip-grid {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
    }

    .skill-chip {
        padding: 0.35rem 0.9rem;
        border-radius: 999px;
        background: rgba(148, 163, 184, 0.15);
        border: 1px solid rgba(148, 163, 184, 0.25);
        font-size: 0.85rem;
        color: rgba(248, 250, 252, 0.9);
        font-weight: 600;
    }

    .skills-bento .skill-chip {
        background: rgba(255, 255, 255, 0.07);
        border-color: rgba(255, 255, 255, 0.12);
        color: rgba(248, 250, 252, 0.88);
        text-transform: uppercase;
        letter-spacing: 0.08em;
        font-size: 0.72rem;
        padding: 0.4rem 0.95rem;
        transition:
            background 0.2s ease,
            border-color 0.2s ease;
    }

    .skills-bento .skill-chip:hover {
        background: rgba(255, 255, 255, 0.12);
        border-color: rgba(255, 255, 255, 0.2);
    }

    .core-skills-card {
        background:
            radial-gradient(circle at 20% 15%, rgba(255, 255, 255, 0.08), transparent 55%),
            linear-gradient(135deg, rgb(8, 47, 73), rgb(15, 23, 42));
        color: #f8fafc;
        border-color: rgba(59, 130, 246, 0.35);
        box-shadow: 0 30px 50px rgba(2, 6, 23, 0.55);
        overflow: hidden;
    }

    .core-language-stack {
        position: relative;
        min-height: clamp(190px, 140px + 4vw, 260px);
        margin-top: 0.75rem;
        isolation: isolate;
    }

    .core-lang-card {
        position: absolute;
        width: min(260px, 68%);
        height: min(260px, 68%);
        left: 50%;
        top: 50%;
        padding: 1rem 1.5rem;
        border-radius: 1.1rem;
        background:
            radial-gradient(circle at 25% 20%, rgba(255, 255, 255, 0.85), transparent 55%),
            linear-gradient(155deg, rgba(255, 255, 255, 0.94), var(--card-accent, rgba(59, 130, 246, 0.65)));
        border: 1px solid rgba(255, 255, 255, 0.65);
        box-shadow: 0 30px 55px rgba(15, 23, 42, 0.35);
        z-index: var(--card-base-z, 1);
        --card-scale: 1;
        transform: translate(-50%, -50%) translate(var(--card-translate-x, 0px), var(--card-translate-y, 0px))
            rotate(var(--card-rotate, 0deg)) scale(var(--card-scale));
        backdrop-filter: blur(6px);
        color: rgba(8, 15, 35, 0.85);
        transition:
            transform 0.6s ease,
            box-shadow 0.4s ease,
            z-index 0.3s ease;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 0.8rem;
    }

    .core-lang-card:hover,
    .core-lang-card:focus-visible,
    .core-lang-card.is-active {
        z-index: 5;
        --card-scale: 1.06;
        box-shadow: 0 35px 60px rgba(15, 23, 42, 0.55);
    }

    .core-lang-card:focus-visible {
        outline: 2px solid rgba(199, 210, 254, 0.8);
        outline-offset: 4px;
    }

    .core-lang-card:nth-child(1) {
        --card-base-z: 2;
        --card-translate-x: -65px;
        --card-translate-y: -42px;
        --card-rotate: -6deg;
    }

    .core-lang-card:nth-child(2) {
        --card-base-z: 3;
        --card-translate-x: 58px;
        --card-translate-y: 45px;
        --card-rotate: 5deg;
    }

    .core-lang-card__label {
        margin: 0;
        font-size: clamp(1.05rem, 0.95rem + 0.5vw, 1.35rem);
        font-weight: 900;
        letter-spacing: 0.05em;
        text-transform: uppercase;
        text-align: center;
        width: 100%;
        word-break: break-word;
        color: rgba(7, 11, 25, 0.85);
    }

    @media (max-width: 640px) {
        .core-language-stack {
            min-height: auto;
        }

        .core-lang-card {
            position: relative;
            width: 100%;
            height: auto;
            left: 0;
            top: 0;
            transform: none !important;
            animation: none;
            margin-bottom: 1rem;
        }

        .core-lang-card:hover,
        .core-lang-card:focus-visible {
            --card-scale: 1;
            box-shadow: 0 15px 25px rgba(15, 23, 42, 0.25);
        }
    }

    @media (min-width: 1024px) {
        .experience-grid,
        .skills-grid {
            grid-template-columns: repeat(3, minmax(0, 1fr));
            grid-auto-rows: minmax(220px, auto);
        }
    }

    @media (prefers-reduced-motion: reduce) {
        .bento-card {
            transition: none;
            opacity: 1 !important;
            transform: none !important;
        }
    }
</style>

<script>
    const prefersReduce = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    let detachSpotlight: (() => void) | undefined;
    let detachCoreStack: (() => void) | undefined;

    function revealCards() {
        const cards = Array.from(document.querySelectorAll<HTMLElement>('.bento-card'));
        if (prefersReduce || !('IntersectionObserver' in window)) {
            cards.forEach((card) => card.classList.add('is-visible'));
            return;
        }

        const io = new IntersectionObserver(
            (entries, observer) => {
                entries.forEach((entry) => {
                    if (entry.isIntersecting) {
                        (entry.target as HTMLElement).classList.add('is-visible');
                        observer.unobserve(entry.target);
                    }
                });
            },
            {
                threshold: 0.25,
                rootMargin: '0px 0px -10% 0px',
            },
        );

        cards.forEach((card) => io.observe(card));
    }

    function attachSpotlightFx() {
        detachSpotlight?.();
        if (prefersReduce) {
            return;
        }

        const cards = Array.from(document.querySelectorAll<HTMLElement>('.bento-card'));
        const cleanups: Array<() => void> = [];

        cards.forEach((card) => {
            // Create spotlight overlay element
            const spotlight = document.createElement('div');
            spotlight.className = 'spotlight-overlay';
            spotlight.style.cssText = `
                position: absolute;
                inset: 0;
                z-index: 0;
                pointer-events: none;
                opacity: 0;
                transition: opacity 0.5s ease-in-out;
                border-radius: inherit;
            `;
            card.style.position = 'relative';
            card.insertBefore(spotlight, card.firstChild);

            const handleMove = (event: PointerEvent) => {
                const rect = card.getBoundingClientRect();
                const x = event.clientX - rect.left;
                const y = event.clientY - rect.top;
                spotlight.style.background = `radial-gradient(circle at ${x}px ${y}px, rgba(255,255,255,0.1), transparent 80%)`;
                spotlight.style.opacity = '1';
            };

            const handleEnter = () => {
                spotlight.style.opacity = '1';
            };

            const handleLeave = () => {
                spotlight.style.opacity = '0';
            };

            card.addEventListener('pointermove', handleMove);
            card.addEventListener('pointerenter', handleEnter);
            card.addEventListener('pointerleave', handleLeave);

            cleanups.push(() => {
                card.removeEventListener('pointermove', handleMove);
                card.removeEventListener('pointerenter', handleEnter);
                card.removeEventListener('pointerleave', handleLeave);
                spotlight.remove();
            });
        });

        detachSpotlight = () => cleanups.forEach((fn) => fn());
    }

    function setupCoreLanguageCards() {
        detachCoreStack?.();

        const stacks = Array.from(document.querySelectorAll<HTMLElement>('.core-language-stack'));
        const cleanups: Array<() => void> = [];

        stacks.forEach((stack) => {
            const cards = Array.from(stack.querySelectorAll<HTMLElement>('.core-lang-card'));
            if (!cards.length) {
                return;
            }

            const activate = (target: HTMLElement) => {
                cards.forEach((card) => card.classList.toggle('is-active', card === target));
            };

            cards.forEach((card) => {
                const handlePointer = () => activate(card);
                card.addEventListener('pointerenter', handlePointer);
                card.addEventListener('focus', handlePointer);
                cleanups.push(() => {
                    card.removeEventListener('pointerenter', handlePointer);
                    card.removeEventListener('focus', handlePointer);
                });
            });

            activate(cards[1]);
        });

        detachCoreStack = () => cleanups.forEach((fn) => fn());
    }

    function hydrateTimeline() {
        revealCards();
        attachSpotlightFx();
        setupCoreLanguageCards();
    }

    window.addEventListener('load', hydrateTimeline);
    document.addEventListener('astro:page-load', hydrateTimeline);
    document.addEventListener('astro:after-swap', hydrateTimeline);
</script>
